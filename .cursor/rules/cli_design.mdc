# Pinocchio CLI è®¾è®¡æ–‡æ¡£

## æ¦‚è¿°

åŸºäº Gemini CLI çš„è®¾è®¡ç†å¿µï¼Œä¸º Pinocchio é¡¹ç›®è®¾è®¡ä¸€ä¸ªäº¤äº’å¼å‘½ä»¤è¡Œç•Œé¢ã€‚é‡‡ç”¨ç®€æ´çš„è§†è§‰æ•ˆæœï¼Œæ”¯æŒæµå¼è¾“å‡ºå’Œå®æ—¶åé¦ˆï¼Œæä¾›ç±»ä¼¼èŠå¤© AI çš„ç”¨æˆ·ä½“éªŒã€‚

---

## ä¸€ã€è®¾è®¡åŸåˆ™

### 1.1 è§†è§‰ä¸€è‡´æ€§
- å‚è€ƒ Gemini CLI çš„ç•Œé¢é£æ ¼
- ä½¿ç”¨ç›¸ä¼¼çš„é¢œè‰²ä¸»é¢˜å’Œå¸ƒå±€
- ä¿æŒç®€æ´å’Œç°ä»£åŒ–çš„è§†è§‰æ•ˆæœ

### 1.2 äº¤äº’ä½“éªŒ
- æµå¼è¾“å‡ºï¼Œå®æ—¶åé¦ˆ
- ç±»ä¼¼èŠå¤© AI çš„å¯¹è¯ä½“éªŒ
- æ”¯æŒå†å²è®°å½•å’Œä¸Šä¸‹æ–‡ç®¡ç†

### 1.3 åŠŸèƒ½æ¸è¿›
- ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€ prompt è¾“å…¥å’Œè¾“å‡º
- ç¬¬äºŒé˜¶æ®µï¼šæ·»åŠ  help å‘½ä»¤å’ŒæŸ¥è¯¢åŠŸèƒ½
- ç¬¬ä¸‰é˜¶æ®µï¼šé›†æˆ historyã€memory ç­‰åŠŸèƒ½

---

## äºŒã€æŠ€æœ¯æ ˆé€‰æ‹©

### 2.1 æ ¸å¿ƒæŠ€æœ¯
- **Python**ï¼šä¸é¡¹ç›®ä¸»ä½“ä¿æŒä¸€è‡´
- **Rich**ï¼šç”¨äºç»ˆç«¯ UI æ¸²æŸ“å’Œæ ¼å¼åŒ–
- **Prompt Toolkit**ï¼šç”¨äºäº¤äº’å¼å‘½ä»¤è¡Œç•Œé¢
- **Asyncio**ï¼šæ”¯æŒå¼‚æ­¥æ“ä½œå’Œæµå¼è¾“å‡º

### 2.2 ä¾èµ–ç®¡ç†
```toml
[tool.poetry.dependencies]
python = "^3.9"
rich = "^13.0.0"
prompt-toolkit = "^3.0.0"
click = "^8.0.0"
pygments = "^2.15.0"
```

---

## ä¸‰ã€ç•Œé¢è®¾è®¡

### 3.1 å¯åŠ¨ç•Œé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸ­ Pinocchio CLI                       â”‚
â”‚                                                           â”‚
â”‚  Welcome to Pinocchio - Multi-Agent Collaboration System  â”‚
â”‚                                                           â”‚
â”‚  Type your request and press Enter to start...           â”‚
â”‚  Type 'help' for available commands                      â”‚
â”‚  Type 'quit' to exit                                     â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

>
```

### 3.2 ä¸»é¢˜é…ç½®

```python
# é¢œè‰²ä¸»é¢˜é…ç½®
THEMES = {
    "default": {
        "primary": "#6366f1",      # Indigo
        "secondary": "#8b5cf6",    # Violet
        "success": "#10b981",      # Emerald
        "warning": "#f59e0b",      # Amber
        "error": "#ef4444",        # Red
        "info": "#3b82f6",         # Blue
        "background": "#0f172a",   # Slate 900
        "foreground": "#f8fafc",   # Slate 50
    },
    "light": {
        "primary": "#6366f1",
        "secondary": "#8b5cf6",
        "success": "#059669",
        "warning": "#d97706",
        "error": "#dc2626",
        "info": "#2563eb",
        "background": "#ffffff",
        "foreground": "#1e293b",
    }
}
```

### 3.3 è¾“å‡ºæ ¼å¼

```python
# æ¶ˆæ¯ç±»å‹å’Œæ ¼å¼
MESSAGE_TYPES = {
    "user": {
        "prefix": "ğŸ‘¤ You",
        "color": "primary",
        "style": "bold"
    },
    "system": {
        "prefix": "ğŸ¤– Pinocchio",
        "color": "secondary",
        "style": "italic"
    },
    "progress": {
        "prefix": "â³",
        "color": "info",
        "style": "dim"
    },
    "success": {
        "prefix": "âœ…",
        "color": "success",
        "style": "bold"
    },
    "error": {
        "prefix": "âŒ",
        "color": "error",
        "style": "bold"
    }
}
```

---

## å››ã€æ ¸å¿ƒåŠŸèƒ½è®¾è®¡

### 4.1 åŸºç¡€ CLI ç±»

```python
import asyncio
from typing import AsyncGenerator, Optional
from rich.console import Console
from rich.prompt import Prompt
from rich.panel import Panel
from rich.text import Text
from rich.live import Live
from rich.table import Table
from prompt_toolkit import PromptSession
from prompt_toolkit.styles import Style

class PinocchioCLI:
    """Pinocchio CLI ä¸»ç±»"""

    def __init__(self):
        self.console = Console()
        self.session = PromptSession()
        self.theme = "default"
        self.history = []
        self.is_running = True

        # åˆå§‹åŒ– Coordinator
        from pinocchio.coordinator import Coordinator
        self.coordinator = Coordinator()

    async def start(self):
        """å¯åŠ¨ CLI"""
        self._show_welcome()

        while self.is_running:
            try:
                # è·å–ç”¨æˆ·è¾“å…¥
                user_input = await self._get_user_input()

                if user_input.lower() in ['quit', 'exit', 'q']:
                    await self._handle_quit()
                    break
                elif user_input.lower() == 'help':
                    self._show_help()
                    continue
                elif user_input.lower() == 'clear':
                    self.console.clear()
                    continue
                elif user_input.lower() == 'history':
                    self._show_history()
                    continue

                # å¤„ç†ç”¨æˆ·è¯·æ±‚
                await self._process_request(user_input)

            except KeyboardInterrupt:
                self.console.print("\n[yellow]Use 'quit' to exit[/yellow]")
            except Exception as e:
                self.console.print(f"[red]Error: {str(e)}[/red]")

    def _show_welcome(self):
        """æ˜¾ç¤ºæ¬¢è¿ç•Œé¢"""
        welcome_text = Text()
        welcome_text.append("ğŸ­ ", style="bold blue")
        welcome_text.append("Pinocchio CLI", style="bold white")
        welcome_text.append("\n\n", style="white")
        welcome_text.append("Welcome to Pinocchio - Multi-Agent Collaboration System", style="white")
        welcome_text.append("\n\n", style="white")
        welcome_text.append("Type your request and press Enter to start...", style="dim white")
        welcome_text.append("\n", style="white")
        welcome_text.append("Type 'help' for available commands", style="dim white")
        welcome_text.append("\n", style="white")
        welcome_text.append("Type 'quit' to exit", style="dim white")

        panel = Panel(
            welcome_text,
            border_style="blue",
            padding=(1, 2)
        )

        self.console.print(panel)
        self.console.print()

    async def _get_user_input(self) -> str:
        """è·å–ç”¨æˆ·è¾“å…¥"""
        prompt_text = Text()
        prompt_text.append("> ", style="bold blue")

        return await self.session.prompt_async(
            prompt_text,
            style=Style.from_dict({
                "prompt": "bold blue",
            })
        )

    async def _process_request(self, user_input: str):
        """å¤„ç†ç”¨æˆ·è¯·æ±‚"""
        # è®°å½•åˆ°å†å²
        self.history.append({
            "type": "user",
            "content": user_input,
            "timestamp": datetime.utcnow()
        })

        # æ˜¾ç¤ºç”¨æˆ·è¾“å…¥
        self._show_message("user", user_input)

        # æ˜¾ç¤ºè¿›åº¦æŒ‡ç¤ºå™¨
        with Live(self._create_progress_panel("Processing request..."), console=self.console):
            # å¤„ç†è¯·æ±‚
            async for message in self.coordinator.process_user_request(user_input):
                # æ›´æ–°è¿›åº¦é¢æ¿
                self._update_progress_panel(message)

                # æ˜¾ç¤ºç³»ç»Ÿæ¶ˆæ¯
                self._show_message("system", message)

        # è®°å½•ç³»ç»Ÿå“åº”
        self.history.append({
            "type": "system",
            "content": message,
            "timestamp": datetime.utcnow()
        })

    def _show_message(self, message_type: str, content: str):
        """æ˜¾ç¤ºæ¶ˆæ¯"""
        config = MESSAGE_TYPES.get(message_type, MESSAGE_TYPES["system"])

        text = Text()
        text.append(f"{config['prefix']}: ", style=f"bold {config['color']}")
        text.append(content, style=config['style'])

        self.console.print(text)
        self.console.print()

    def _create_progress_panel(self, message: str) -> Panel:
        """åˆ›å»ºè¿›åº¦é¢æ¿"""
        text = Text()
        text.append("â³ ", style="bold yellow")
        text.append(message, style="white")

        return Panel(text, border_style="yellow")

    def _update_progress_panel(self, message: str):
        """æ›´æ–°è¿›åº¦é¢æ¿"""
        # è¿™é‡Œå¯ä»¥å®ç°æ›´å¤æ‚çš„è¿›åº¦æ˜¾ç¤ºé€»è¾‘
        pass

    def _show_help(self):
        """æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯"""
        help_text = Text()
        help_text.append("Available Commands:\n\n", style="bold white")

        commands = [
            ("help", "Show this help message"),
            ("history", "Show conversation history"),
            ("clear", "Clear the screen"),
            ("quit", "Exit the application"),
            ("memory", "Show memory information"),
            ("sessions", "List recent sessions"),
        ]

        for cmd, desc in commands:
            help_text.append(f"  {cmd:<10}", style="bold blue")
            help_text.append(f"{desc}\n", style="white")

        panel = Panel(help_text, border_style="blue", title="Help")
        self.console.print(panel)
        self.console.print()

    def _show_history(self):
        """æ˜¾ç¤ºå†å²è®°å½•"""
        if not self.history:
            self.console.print("[dim]No history available[/dim]")
            return

        table = Table(title="Conversation History")
        table.add_column("Time", style="cyan")
        table.add_column("Type", style="magenta")
        table.add_column("Content", style="white")

        for entry in self.history[-10:]:  # æ˜¾ç¤ºæœ€è¿‘10æ¡
            time_str = entry["timestamp"].strftime("%H:%M:%S")
            content = entry["content"][:50] + "..." if len(entry["content"]) > 50 else entry["content"]

            table.add_row(
                time_str,
                entry["type"].upper(),
                content
            )

        self.console.print(table)
        self.console.print()

    async def _handle_quit(self):
        """å¤„ç†é€€å‡º"""
        self.console.print("[yellow]Goodbye! ğŸ‘‹[/yellow]")
        self.is_running = False
```

### 4.2 å‘½ä»¤å¤„ç†å™¨

```python
class CommandProcessor:
    """å‘½ä»¤å¤„ç†å™¨"""

    def __init__(self, coordinator):
        self.coordinator = coordinator
        self.commands = {
            "help": self._cmd_help,
            "history": self._cmd_history,
            "memory": self._cmd_memory,
            "sessions": self._cmd_sessions,
            "clear": self._cmd_clear,
            "quit": self._cmd_quit,
        }

    async def process_command(self, command: str, args: list = None) -> bool:
        """å¤„ç†å‘½ä»¤"""
        if command in self.commands:
            await self.commands[command](args or [])
            return True
        return False

    async def _cmd_help(self, args):
        """å¸®åŠ©å‘½ä»¤"""
        # å®ç°å¸®åŠ©åŠŸèƒ½
        pass

    async def _cmd_history(self, args):
        """å†å²å‘½ä»¤"""
        # å®ç°å†å²æŸ¥è¯¢åŠŸèƒ½
        pass

    async def _cmd_memory(self, args):
        """å†…å­˜å‘½ä»¤"""
        # å®ç°å†…å­˜æŸ¥è¯¢åŠŸèƒ½
        pass

    async def _cmd_sessions(self, args):
        """ä¼šè¯å‘½ä»¤"""
        # å®ç°ä¼šè¯æŸ¥è¯¢åŠŸèƒ½
        pass

    async def _cmd_clear(self, args):
        """æ¸…å±å‘½ä»¤"""
        # å®ç°æ¸…å±åŠŸèƒ½
        pass

    async def _cmd_quit(self, args):
        """é€€å‡ºå‘½ä»¤"""
        # å®ç°é€€å‡ºåŠŸèƒ½
        pass
```

---

## äº”ã€åˆ†é˜¶æ®µå®ç°è®¡åˆ’

### 5.1 ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€åŠŸèƒ½ï¼ˆWeek 1ï¼‰

#### 5.1.1 æ ¸å¿ƒ CLI æ¡†æ¶
- [ ] **åŸºç¡€ CLI ç±»å®ç°**
  - [ ] æ¬¢è¿ç•Œé¢
  - [ ] ç”¨æˆ·è¾“å…¥å¤„ç†
  - [ ] åŸºæœ¬å‘½ä»¤æ”¯æŒï¼ˆhelp, quit, clearï¼‰
  - [ ] ç®€å•çš„æ¶ˆæ¯æ˜¾ç¤º

#### 5.1.2 ä¸ Coordinator é›†æˆ
- [ ] **é›†æˆ Coordinator**
  - [ ] å¼‚æ­¥è¯·æ±‚å¤„ç†
  - [ ] æµå¼è¾“å‡ºæ˜¾ç¤º
  - [ ] è¿›åº¦æŒ‡ç¤ºå™¨
  - [ ] é”™è¯¯å¤„ç†

#### 5.1.3 åŸºç¡€ UI ç»„ä»¶
- [ ] **Rich ç»„ä»¶å®ç°**
  - [ ] æ¶ˆæ¯é¢æ¿
  - [ ] è¿›åº¦æ¡
  - [ ] çŠ¶æ€æŒ‡ç¤ºå™¨
  - [ ] é¢œè‰²ä¸»é¢˜

### 5.2 ç¬¬äºŒé˜¶æ®µï¼šå¢å¼ºåŠŸèƒ½ï¼ˆWeek 2ï¼‰

#### 5.2.1 å‘½ä»¤ç³»ç»Ÿ
- [ ] **å‘½ä»¤å¤„ç†å™¨**
  - [ ] å‘½ä»¤è§£æ
  - [ ] å‚æ•°å¤„ç†
  - [ ] å‘½ä»¤æ³¨å†Œæœºåˆ¶
  - [ ] å¸®åŠ©ç³»ç»Ÿ

#### 5.2.2 å†å²è®°å½•
- [ ] **å†å²ç®¡ç†**
  - [ ] å¯¹è¯å†å²è®°å½•
  - [ ] å†å²æŸ¥è¯¢
  - [ ] å†å²å¯¼å‡º
  - [ ] å†å²æœç´¢

#### 5.2.3 ä¼šè¯ç®¡ç†
- [ ] **ä¼šè¯åŠŸèƒ½**
  - [ ] ä¼šè¯åˆ—è¡¨
  - [ ] ä¼šè¯è¯¦æƒ…
  - [ ] ä¼šè¯åˆ‡æ¢
  - [ ] ä¼šè¯åˆ é™¤

### 5.3 ç¬¬ä¸‰é˜¶æ®µï¼šé«˜çº§åŠŸèƒ½ï¼ˆWeek 3ï¼‰

#### 5.3.1 å†…å­˜ç®¡ç†
- [ ] **å†…å­˜æŸ¥è¯¢**
  - [ ] å†…å­˜ç»Ÿè®¡
  - [ ] å†…å­˜æœç´¢
  - [ ] å†…å­˜æ¸…ç†
  - [ ] å†…å­˜å¯¼å‡º

#### 5.3.2 é…ç½®ç®¡ç†
- [ ] **é…ç½®ç³»ç»Ÿ**
  - [ ] ä¸»é¢˜é…ç½®
  - [ ] API é…ç½®
  - [ ] ä»£ç†é…ç½®
  - [ ] é…ç½®å¯¼å…¥å¯¼å‡º

#### 5.3.3 æ’ä»¶ç³»ç»Ÿ
- [ ] **æ’ä»¶æ”¯æŒ**
  - [ ] æ’ä»¶åŠ è½½
  - [ ] æ’ä»¶ç®¡ç†
  - [ ] è‡ªå®šä¹‰å‘½ä»¤
  - [ ] æ‰©å±•åŠŸèƒ½

---

## å…­ã€å®‰è£…å’Œé…ç½®

### 6.1 å®‰è£…è„šæœ¬

```python
# setup.py
from setuptools import setup, find_packages

setup(
    name="pinocchio-cli",
    version="0.1.0",
    packages=find_packages(),
    install_requires=[
        "rich>=13.0.0",
        "prompt-toolkit>=3.0.0",
        "click>=8.0.0",
        "pygments>=2.15.0",
    ],
    entry_points={
        "console_scripts": [
            "pinocchio=pinocchio.cli.main:main",
        ],
    },
)
```

### 6.2 é…ç½®æ–‡ä»¶

```yaml
# config.yaml
cli:
  theme: "default"
  history_size: 100
  auto_save: true

display:
  show_timestamps: true
  show_progress: true
  max_line_length: 80

api:
  timeout: 30
  max_retries: 3
  model: "gpt-4"
```

---

## ä¸ƒã€ä½¿ç”¨ç¤ºä¾‹

### 7.1 åŸºç¡€ä½¿ç”¨

```bash
# å®‰è£…
pip install pinocchio-cli

# å¯åŠ¨
pinocchio

# äº¤äº’å¼ä½¿ç”¨
> ç¼–å†™ä¸€ä¸ªconv2dç®—å­
ğŸ¤– Pinocchio: æ­£åœ¨åˆ†ææ‚¨çš„éœ€æ±‚...
ğŸ¤– Pinocchio: ç”Ÿæˆä»£ç ä¸­...
ğŸ¤– Pinocchio: ä»£ç ç”Ÿæˆå®Œæˆï¼

> help
ğŸ“– Help: æ˜¾ç¤ºå¯ç”¨å‘½ä»¤

> history
ğŸ“‹ History: æ˜¾ç¤ºå¯¹è¯å†å²

> quit
ğŸ‘‹ Goodbye!
```

### 7.2 é«˜çº§åŠŸèƒ½

```bash
# æŸ¥çœ‹å†…å­˜ä¿¡æ¯
> memory
ğŸ§  Memory: æ˜¾ç¤ºå†…å­˜ç»Ÿè®¡

# æŸ¥çœ‹ä¼šè¯åˆ—è¡¨
> sessions
ğŸ“ Sessions: æ˜¾ç¤ºä¼šè¯åˆ—è¡¨

# åˆ‡æ¢ä¸»é¢˜
> theme dark
ğŸ¨ Theme: åˆ‡æ¢åˆ°æ·±è‰²ä¸»é¢˜
```

---

## å…«ã€æ€»ç»“

è¿™ä¸ª CLI è®¾è®¡å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

1. **è§†è§‰ä¸€è‡´æ€§**ï¼šå‚è€ƒ Gemini CLI çš„è®¾è®¡é£æ ¼
2. **äº¤äº’ä½“éªŒ**ï¼šæµå¼è¾“å‡ºï¼Œå®æ—¶åé¦ˆ
3. **åŠŸèƒ½æ¸è¿›**ï¼šåˆ†é˜¶æ®µå®ç°ï¼Œé€æ­¥å®Œå–„
4. **æ˜“äºæ‰©å±•**ï¼šæ¨¡å—åŒ–è®¾è®¡ï¼Œæ”¯æŒæ’ä»¶
5. **ç”¨æˆ·å‹å¥½**ï¼šæ¸…æ™°çš„ç•Œé¢å’Œå¸®åŠ©ç³»ç»Ÿ

é€šè¿‡è¿™ä¸ªè®¾è®¡ï¼Œç”¨æˆ·å¯ä»¥è·å¾—ç±»ä¼¼ Gemini CLI çš„ç°ä»£åŒ–å‘½ä»¤è¡Œä½“éªŒï¼ŒåŒæ—¶å……åˆ†åˆ©ç”¨ Pinocchio çš„å¤šæ™ºèƒ½ä½“åä½œèƒ½åŠ›ã€‚
description:
globs:
alwaysApply: false
---
